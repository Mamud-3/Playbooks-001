- hosts: localhost
  connection: local

  vars:
    gestures_url: http://github.com/bulletmark/libinput-gestures
    gestures_tmp: /tmp/gestures

  tasks:

    - name: get the username
      become: false
      command: whoami
      register: whoami_output

    - name: add user to group input
      become: yes
      command: "gpasswd -a {{ whoami_output.stdout }} input"

    - name: install dependencies
      become: yes
      apt:
        name: ["xdotool", "wmctrl", "libinput-tools"]
        state: present

    - name: Creates gestures temporary directory
      become: yes
      file:
        path: "{{ gestures_tmp }}"
        state: directory

    - name: Clone gestures project
      become: yes
      git:
        repo: "{{ gestures_url }}"
        dest: "{{ gestures_tmp }}"

    - name: Install gestures
      become: yes
      command: ./libinput-gestures-setup install
      args:
        chdir: "{{ gestures_tmp }}"

    - name: Remove gestures temporary directory
      become: yes
      file:
        path: "{{ gestures_tmp }}"
        state: absent

    - name: Creates configuration directory
      become: false
      file:
        path: "/home/{{ whoami_output.stdout }}/.config"
        state: directory

    - name: create config file
      become: false
      template: 
        src: templates/libinput-gestures.j2
        dest: "/home/{{ whoami_output.stdout }}/.config/libinput-gestures.conf"

    - name: apply gestures configuration
      become: false
      command : libinput-gestures-setup restart

    - name: autostart gestures 
      become: false
      command : libinput-gestures-setup autostart